import Data.Array
import Data.List (sort)
import Prob003 (primeNumbers)
import Prob038 (digitList)

minLimit = 1000
maxLimit = 9999

primeList = primesRange minLimit maxLimit

primesRange a b = takeWhile (<= b) $ dropWhile (< a) primeNumbers

arePrimes = (listArray (minLimit, maxLimit) (cycle [False]))
                // map (\p -> (p, True)) primeList


primeSequences = [ (a, b, c) | a <- primeList,
                               b <- primesRange (a + 1) maxLimit,
                               let c = 2 * b - a, c <= maxLimit,
                               arePrimes ! c ]

areDigitPerms (a, b, c) = digits a == digits b && digits a == digits c
    where digits = sort . digitList


result = (read::String -> Integer) . concatTriplet . head . tail 
            $ filter areDigitPerms primeSequences
    where concatTriplet (a, b, c) = show a ++ show b ++ show c
-- [(1487,4817,8147),(2969,6299,9629)]
-- 296962999629


main = print result
-- Compiled for limits 10000 to 99999:
{-
[(11483,14813,18143),(11497,41719,71941),(12713,13217,13721),
 (12739,17239,21739),(12757,17257,21757),(12799,17299,21799),
 (14821,48121,81421),(14831,31481,48131),(14897,47189,79481),
 (18503,51803,85103),(18593,51893,85193),(19543,35491,51439),
 (20161,20611,21061),(20353,25303,30253),(20359,25309,30259),
 (20747,24077,27407),(23887,28387,32887),(25087,52807,80527),
 (25793,59273,92753),(25913,39521,53129),(25981,59281,92581),
 (26317,31267,36217),(26597,59627,92657),(28933,29383,29833),
 (29669,62969,96269),(31489,34819,38149),(31489,39841,48193),
 (32969,63299,93629),(34961,39461,43961),(35407,40357,45307),
 (35491,39541,43591),(35671,53617,71563),(37561,51637,65713),
 (49547,54497,59447),(55603,56053,56503),(60373,63703,67033),
 (60757,65707,70657),(61487,64817,68147),(62597,65927,69257),
 (62773,67723,72673),(63499,63949,64399),(67829,68279,68729),
 (68713,78163,87613),(71947,74719,77491),(73589,78593,83597),
 (76717,77167,77617),(76819,81769,86719),(78941,84179,89417),
 (80191,89101,98011),(83987,88937,93887),(88937,93887,98837),
 (89387,93887,98387),(92381,92831,93281)]
-}
